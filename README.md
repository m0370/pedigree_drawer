# 🧬 遺伝学的家系図作成 GPTs (v0.2)

JOHBOC（日本遺伝性腫瘍学会）および日本人類遺伝学会のガイドライン（**Bennett 2022年改訂版**準拠）に基づいた、遺伝診療用家系図（Genogram/Pedigree Chart）を作成するための ChatGPT (GPTs) 用アセットです。

> [!WARNING]
> **⚠️ 開発中 (Beta) ⚠️**
> 本プロジェクトは現在 **v0.2 (ベータ版)** です。
> 研究・開発目的で公開されており、**臨床現場での実運用にはまだ達していません。**
> 生成された家系図の正確性を保証するものではなく、使用に伴う責任は負いかねます。必ず専門家の確認を併用してください。

## 概要
*   自然言語での対話から家系情報を構造化し、SVG形式の家系図を自動生成します。
*   **JOHBOC/Bennett 2022年改訂版準拠**: セックスとジェンダーの区別、保因者ドット表記の廃止など、最新の国際標準に準拠しています。
*   **SVG出力**: draw.io や Illustrator 等で後編集可能なベクターデータを出力します。
*   **PowerPoint編集**: PowerPoint取り込み後に各線・記号・文字を個別に選択/削除しやすいSVG構造で出力します。
*   **決定論的レンダリング**: JSON中間表現により、同じ入力から常に同じ出力が得られます。

## ファイル構成
*   `genealogy_gpt_instructions.md`: GPTs の "Instructions" に設定するプロンプト。
*   `pedigree_drawer_lib_v0_2.py`: GPTs の "Knowledge" にアップロードする描画エンジン (Python)。
*   `render_pedigree.py`: ローカル環境でJSONからSVGを生成するCLIツール（オプション）。
*   `開発ログ/`: 開発経緯の記録。
*   `家系図の描き方/`: JOHBOC家系図記載法などの参考資料。

## 使い方 (GPTsセットアップ)

1. **ChatGPT** で「Explore GPTs」→「+ Create」を選択。
2. **Configure** タブを開く。
3. **Instructions** 欄に `genealogy_gpt_instructions.md` の内容をすべて貼り付ける。
4. **Knowledge** の「Upload files」から `pedigree_drawer_lib_v0_2.py` をアップロードする。
5. **Capabilities** で「Code Interpreter」のみを ON にする（Web Browsing, DALL-E は OFF）。
6. 保存して使用開始。

## ローカルでSVG生成（任意）
`python3` がある環境なら、JSONから直接SVGを生成できます。

```sh
python3 render_pedigree.py input.json -o pedigree.svg
```

## 主な機能と制約 (v0.2)

### 対応している記号・機能（JOHBOC/Bennett 2022準拠）
*   ✅ ジェンダー記号（□男性, ○女性, ◇性別不明/多様）
*   ✅ セックスとジェンダー区別（AMAB/AFAB/UAAB表記対応）
*   ✅ 発端者 (P↗) / 来談者 (↗)
*   ✅ 罹患者 (黒塗り) / 死亡 (左下から右上の斜線 /)
*   ✅ 妊娠関連: 自然流産 (△), 人工妊娠中絶 (△+斜線), 死産 (SB+斜線), 妊娠中 (P)
*   ✅ 無症状変異保有者 (縦線) / 記録確認済み (*)
*   ✅ 関係線: 婚姻, 近親婚(二重線), 離婚(//)
*   ✅ 世代表示（ローマ数字）、個体番号（I-1, II-2等）
*   ✅ メタデータ（作成日、作成者）
*   ✅ 複数個体の一括表記（記号内に数字表示、例：□内に「5」= 5人の男性）
*   ✅ 診断時年齢の記録（`diagnoses[]`配列による複数疾患対応）
*   ✅ 遺伝学的検査情報、双生児、養子、生殖補助技術（JSON v0.2スキーマで対応）

### 現状の制約 (Limitations)
*   **レイアウト**: 簡易的な自動配置アルゴリズムのため、複雑な多世代・多人数家系では線が重なる場合があります。
*   **双生児**: データの入力としては対応していますが、描画（分岐線、一卵性双生児の水平線接続）が完全に最適化されていません。
*   **特殊ケース**: 代理母・卵子提供・養子縁組などの生殖補助技術に関する描画は一部未実装です。

### JOHBOC準拠要素のうち未対応の事項（将来的な改良予定）

以下のJOHBOC家系図記載法で定義されている要素は、現在のJSON v0.2スキーマでは未対応です：

**優先度: 中**
*   ⚠️ **異所性妊娠（ECT）**: 妊娠関連イベントの一種として、JSON schema への明示的なフィールド追加が必要
*   ⚠️ **核型情報（Karyotype）**: 流産時の染色体検査結果や、VSCの診断情報として記録する機能
*   ⚠️ **VSC（Variations of Sex Characteristics）**: 生物学的性のバリエーションに関する詳細情報の構造化

**優先度: 低**
*   ⚠️ **保因者の塗りつぶしパターン詳細**: 現在は縦線（`presymptomatic_carrier`）のみ対応。複数の保因状態を区別する塗りつぶしパターンの拡張
*   ⚠️ **祖先情報の構造化**: 両祖父母の祖先（臨床上関係がある場合）を記録するフィールド
*   ⚠️ **片親（Single parent）の明示的表記**: 現在は `partners` 配列に1人のみ含めることで表現可能だが、より明示的な `type: "single_parent"` の追加を検討

これらの要素は、JOHBOC準拠の観点では記録可能であることが望ましいですが、現時点では優先度を下げて後回しとしています。

## ライセンス
MIT License
