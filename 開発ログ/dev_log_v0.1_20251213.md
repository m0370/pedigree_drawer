# 遺伝学的家系図作成GPTs 開発ログ v0.1
**日付**: 2025年12月13日
**バージョン**: v0.1
**作成者**: Antigravity Assistant

## 1. プロジェクトの目的
JOHBOC（日本遺伝性腫瘍学会）および日本人類遺伝学会のガイドラインに厳格に準拠した、遺伝学的家系図を作成するGPTsを構築すること。最終成果物としてSVG形式の画像を出力し、draw.io等での二次利用を可能にする。

## 2. 開発プロセスと意思決定

### Phase 1: 要件定義と初期設計
*   **課題**: GPT標準の描画機能（DALL-E）では、医学的に正確な記号（斜線、矢印、塗りつぶし）を描けない。
*   **解決策**: Code Interpreter (Python) を使用し、`matplotlib` ライブラリで図形をプログラム的に描画する方式を採用。
*   **役割分担の確立**:
    *   **GPT (LLM)**: 自然言語のヒアリング、情報の正規化（JSONデータ化）。
    *   **Python**: 定義されたJSONを読み込み、厳密なルールに基づいて作図。

### Phase 2: ルールセットの策定と実装
*   **参照資料**: 
    1. Bennett et al. (NSGC/国際標準)
    2. JOHBOC ガイドブック 2024 / 日本人類遺伝学会指針
*   **実装した厳格なルール**:
    *   **基本記号**: 男性(□)、女性(○)、性別不明/ジェンダー(◇)。
    *   **特殊な記号**: 
        *   自然流産(△)、人工妊娠中絶(△に斜線)。
        *   死産(SB + 左下から右上の斜線)。
        *   発端者(P + 矢印↗)、来談者(矢印↗のみ)。
        *   無症状変異保有者(記号中央に縦線)。
        *   記録確認済み(記号右下に*)。
    *   **関係線**: 婚姻(水平線)、近親婚(二重線)、離婚(斜線//)。
    *   **死亡表現の修正**: 当初「右上から左下」で実装したが、JOHBOC資料（`10.34433...txt`）の記述に従い、**「左下から右上 (／)」** へ変更。

### Phase 3: アーキテクチャの最適化
*   **JSONスキーマの導入**: 
    *   GPTが描画コードを毎回ゼロから書くと不安定になるため、**「特定のJSON形式を出力する」** ことだけをGPTの責務とした。
    *   Python側（Knowledge）に `load_from_json(data)` メソッドを追加し、データ流し込みによる描画を実現。
*   **SVG出力**:
    *   draw.io との連携を見据え、ラスター画像(PNG)ではなくベクター画像(SVG)での出力を必須化。
    *   `pedigree_drawer_lib.py` に `render_and_save(filename='pedigree.svg')` を実装。

## 3. 成果物構成

### 構成ファイル
1.  **`genealogy_gpt_instructions.md`**
    *   GPTsの「Instructions」に設定するプロンプト。
    *   対話の振る舞い、情報収集フロー、JSONスキーマ定義を含む。
2.  **`pedigree_drawer_lib.py`**
    *   GPTsの「Knowledge」にアップロードするPythonライブラリ。
    *   `matplotlib` を用いた実際の描画ロジック（JOHBOC準拠の図形描画）を含む。

### GPTs設定 (日本語UI)
*   **指示 (Instructions)**: `genealogy_gpt_instructions.md` の内容を貼り付け。
*   **知識 (Knowledge)**: `pedigree_drawer_lib.py` をアップロード。
*   **機能 (Capabilities)**: 「コードインタープリター」のみON。WebブラウジングとDALL-EはOFF。

## 4. 今後の展望・改善点
*   **レイアウトアルゴリズムの高度化**: 現在は簡易的な自動配置だが、複雑な近親婚や多世代家系に対応するためのレイアウトロジック（Reingold-Tilford法など）の導入。
*   **電子カルテ連携**: 将来的にはJSON出力をFHIR形式等に変換し、外部システムと連携する可能性。

---
*End of This Log*
